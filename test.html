
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Puyo Puyo</title>
</head>
<body>
  <canvas width="300" height="600" id="canvas" style="border:1px solid black"></canvas>
  <script>
  const CANVAS = document.getElementById("canvas");
  const CONTEXT = CANVAS.getContext("2d");

  let field = [
    [0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0],
    [0, 2, 0, 0, 0, 0],
    [1, 2, 0, 3, 4, 4]
  ];

  let position = [2, 0];
  let child =  [0, 1];
  let color = [Math.floor(Math.random() * 4 + 1), Math.floor(Math.random() * 4 + 1)];

  let down_speed = 0.02;

  function downPuyo() {
    position[1] += down_speed;

    if (position[1] >= 11 || position[1] + child[1] >= 11) {
      field[Math.floor(position[1])][Math.floor(position[0])] = color[1];
      field[Math.floor(position[1] + child[1])][Math.floor(position[0] + child[0])] = color[0];

      position = [2, 0];
      child = [0, 1];
      color = [Math.floor(Math.random() * 4 + 1), Math.floor(Math.random() * 4 + 1)];
    }else if (field[Math.floor(position[1]) + 1][Math.floor(position[0])] > 0 || field[Math.floor(position[1] + child[1]) + 1][Math.floor(position[0] + child[0])] > 0) {
      field[Math.floor(position[1])][Math.floor(position[0])] = color[1];
      field[Math.floor(position[1] + child[1])][Math.floor(position[0] + child[0])] = color[0];

      position = [2, 0];
      child = [0, 1];
      color = [Math.floor(Math.random() * 4 + 1), Math.floor(Math.random() * 4 + 1)];

    }

    drawField();
  }

  let timer = setInterval(downPuyo, 1000 / 60);

  function drawField() {
    CONTEXT.clearRect(0, 0, 300, 600);
    switch (color[0]) {
      case 1:
      CONTEXT.fillStyle = "red";
      break;
      case 2:
      CONTEXT.fillStyle = "yellow";
      break;
      case 3:
      CONTEXT.fillStyle = "blue";
      break;
      case 4:
      CONTEXT.fillStyle = "green";
      break;

    }
    CONTEXT.fillRect((position[0] + child[0]) * 50, (position[1] + child[1]) * 50, 50, 50);

    switch (color[1]) {
      case 1:
      CONTEXT.fillStyle = "red";
      break;
      case 2:
      CONTEXT.fillStyle = "yellow";
      break;
      case 3:
      CONTEXT.fillStyle = "blue";
      break;
      case 4:
      CONTEXT.fillStyle = "green";
      break;

    }
    CONTEXT.fillRect(position[0] * 50, position[1] * 60, 50, 50);

    for (let i = 0; i < 12; i++) {
      for (let j = 0; j < 6; j++) {
        if (field[i][j] > 0) {
          switch (field[i][j]) {
            case 1:
            CONTEXT.fillStyle = "red";
            break;
            case 2:
            CONTEXT.fillStyle = "yellow";
            break;
            case 3:
            CONTEXT.fillStyle = "blue";
            break;
            case 4:
            CONTEXT.fillStyle = "green";
            break;

          }
          CONTEXT.fillRect(j * 50, i * 50, 50, 50);
        }
      }
    }
  }

  drawField();

  </script>
</body>
</html>